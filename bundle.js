(()=>{var globalDataObj={};function styleRows(){$("#quarters, #profit-loss, #balance-sheet, #cash-flow, #ratios").find("table.data-table tbody").find("tr:even").addClass("stripe")}async function collectDataInObject(){let t={};const e=[{selector:"#quarters",property:"quarterData"},{selector:"#profit-loss",property:"profitData"},{selector:"#balance-sheet",property:"balanceSheetData"},{selector:"#cash-flow",property:"cashFlowData"},{selector:"#ratios",property:"ratios"}];for(const a of e){const e={};$(`${a.selector} .data-table:first tbody tr`).each(function(){let t=$(this).find("td.text button").text().trim()||$(this).find("td.text").text().trim();if(t=t.replace("\n","").replace(" -","").replace("-","").replace(" +","").trim(),"Raw PDF"!==t){const o={};$(this).find("td:not(.text)").each(function(t){const e=$(`${a.selector} .data-table:first thead th:eq(${t+1})`).text().trim(),s=$(this).text().trim();o[e]=s?parseFloat(s.replace(/,/g,"")):""}),"Sales"!=t&&"Net Profit"!=t||$(this).css("font-weight","600"),e[t]=o}}),t[a.property]=e}const a=$("#cash-flow .data-table:eq(0)"),o=a.find('td.text:contains("Net Cash Flow")').closest("tr"),s=o.clone().removeClass("stripe").addClass("custom-row");s.insertAfter(o),s.find("td.text").last().text("Free cash flow"),s.find("td:not(:first)").text("");const n=s.clone().removeClass("custom-row");n.insertAfter(s),n.find("td.text").last().text("Cash EPS").closest("tr").removeClass("strong"),n.find("td:not(:first)").text("");const l=n.clone().addClass("custom-row");l.insertAfter(n),l.find("td.text").last().text("Reinvestment (Capex/CFO)").closest("tr").removeClass("strong"),l.find("td:not(:first)").text("");const r=s.clone().removeClass("custom-row");r.insertAfter(l),r.find("td.text").last().text("CFO to PAT").closest("tr").removeClass("strong"),r.find("td:not(:first)").text("");const i=n.clone().addClass("custom-row");i.insertAfter(r),i.find("td.text").last().text("CFO to EBITDA").closest("tr").removeClass("strong"),i.find("td:not(:first)").text(""),t=await fetchAndProcessApiData(t);const c={},d=t.cashFlowData,f=t.profitData;Object.keys(d["Cash from Operating Activity"]).forEach((t,e)=>{const o=d["Cash from Operating Activity"]&&d["Cash from Operating Activity"][t]||0,s=d["Fixed assets purchased"]&&d["Fixed assets purchased"][t]||0,n=d["Fixed assets sold"]&&d["Fixed assets sold"]&&d["Fixed assets sold"][t]||0;c[t]=o+s+n;a.find('td.text:contains("Free cash flow")').closest("tr").find(`td:eq(${e+1})`).text(parseFloat(c[t]).toFixed(2));const l=f["No of outstanding shares"][t];let r=l&&0!==l?parseFloat(c[t]/l).toFixed(2):"";r=isNaN(r)||!isFinite(r)?0:r;a.find('td.text:contains("Cash EPS")').closest("tr").find(`td:eq(${e+1})`).text(r);const i=o&&!isNaN(o)&&s&&!isNaN(s)?parseFloat(Math.abs(s)/o*100).toFixed(2)+"%":"";a.find('td.text:contains("Reinvestment (Capex/CFO)")').closest("tr").find(`td:eq(${e+1})`).text(i);const b=f["Profit after tax"]?f["Profit after tax"][t]:"",p=o&&!isNaN(o)&&b&&!isNaN(b)?parseFloat(o/b*100).toFixed(2)+"%":"";a.find('td.text:contains("CFO to PAT")').closest("tr").find(`td:eq(${e+1})`).text(p);const u=f["Operating Profit"]?f["Operating Profit"][t]:"",g=d["Direct taxes"]&&d["Direct taxes"][t]||0,h=o&&!isNaN(o)&&g&&!isNaN(g)||0==o?parseFloat(o+Math.abs(g)).toFixed(2):"",m=h&&!isNaN(h)&&u&&!isNaN(u)?parseFloat(h/u*100).toFixed(2)+"%":"";a.find('td.text:contains("CFO to EBITDA")').closest("tr").find(`td:eq(${e+1})`).text(m)}),d["Free cash flow"]=c;let b={"Cash from Operating Activity":d["Cash from Operating Activity"],"Cash from Investing Activity":d["Cash from Investing Activity"],"Cash from Financing Activity":d["Cash from Financing Activity"],"Free cash flow":d["Free cash flow"]};$(".ranges-table").closest("div").css("margin-top","15px").clone().insertAfter($("#cash-flow .responsive-holder"));const p=[3,5,7,10],u=["Cash from Operating Activity","Cash from Investing Activity","Cash from Financing Activity","Free cash flow"];for(let e of u){const a=`${e} Growth`;t.cashFlowData[a]={};for(let o of p){const s=calculateCashFlowCAGR(d,e,o);t.cashFlowData[a][o]=s?parseFloat(s).toFixed(2):0}}return p.forEach((e,a)=>{let o=$("#cash-flow .ranges-table:eq("+a+")");o.find("th").text("Cumulative of "+e+" years");const s=calculateCumulativeCashFlows(b,e),n=Math.round(t.cashFlowData["Cash from Operating Activity Growth"][e])>0?"success-color":"error-color",l=Math.round(t.cashFlowData["Cash from Investing Activity Growth"][e])>0?"success-color":"error-color",r=Math.round(t.cashFlowData["Cash from Financing Activity Growth"][e])>0?"success-color":"error-color",i=Math.round(t.cashFlowData["Free cash flow Growth"][e])>0?"success-color":"error-color";o.find("th").text("Cumulative of "+e+" years"),o.find("tr:eq(1) td:eq(0)").text("Operating cash flow").next("td").html(s["Cash from Operating Activity"].toLocaleString("en-IN")+' <span class="'+n+' small">('+Math.round(t.cashFlowData["Cash from Operating Activity Growth"][e])+"%)</span>"),o.find("tr:eq(2) td:eq(0)").text("Investing cash flow:").next("td").html(s["Cash from Investing Activity"].toLocaleString("en-IN")+' <span class="'+l+' small">('+Math.round(t.cashFlowData["Cash from Investing Activity Growth"][e])+"%)</span>"),o.find("tr:eq(3) td:eq(0)").text("Financing cash flow:").next("td").html(s["Cash from Financing Activity"].toLocaleString("en-IN")+' <span class="'+r+' small">('+Math.round(t.cashFlowData["Cash from Financing Activity Growth"][e])+"%)</span>"),o.find("tr:eq(4) td:eq(0)").text("Free cash flow:").next("td").html(toLocaleStringRounded(s["Free cash flow"])+' <span class="'+i+' small">('+Math.round(t.cashFlowData["Free cash flow Growth"][e])+"%)</span>")}),t}async function fetchAndProcessApiData(t){try{const e=$("#company-info").data("company-id"),a=`https://www.screener.in/api/company/${e}/chart/?q=Price-DMA50-DMA200-Volume&days=${calculateDaysPassed()}`,o=await fetch(a),s=await o.json();if(!s)return console.log("API data not available."),t;const n=s.datasets?.[0]?.values||[],l={},r={},i={};for(const t of n){const e=new Date(t[0]),a=e.getFullYear();3===e.getMonth()+1&&(l[a]={date:t[0],price:t[1]})}for(const e in l){const a=l[e].price;if(a){r[`Mar ${e}`]=a;let o=t.profitData["EPS in Rs"][`Mar ${e}`];o?i[`Mar ${e}`]=parseFloat(a/o).toFixed(2):(o=t.profitData["EPS in Rs"][`Dec ${e}`],o&&(i[`Dec ${e}`]=parseFloat(a/o).toFixed(2),r[`Dec ${e}`]=a))}}if("TTM"===Object.keys(t.profitData.Sales).pop()){const e=n[n.length-1]?.[1];if(e){r.TTM=e;const a=t.profitData["EPS in Rs"].TTM;a&&(i.TTM=parseFloat(e/a).toFixed(2))}}t.priceData=r,t.profitData.PE=i,(t=calculateAndInsertBookValuePerShare(t)).trends=growthTrend(t.profitData)}catch(t){console.log("Error processing data:",t)}return t}function calculateAndInsertBookValuePerShare(t){const e=Object.keys(t.profitData.Sales),a={},o={},s={};return e.forEach((n,l)=>{let r=0;t.balanceSheetData.Reserves[n]&&t.balanceSheetData["Equity Capital"][n]?r=t.balanceSheetData.Reserves[n]+t.balanceSheetData["Equity Capital"][n]:l>0&&t.balanceSheetData.Reserves[e[l-1]]&&t.balanceSheetData["Equity Capital"][e[l-1]]&&(r=t.balanceSheetData.Reserves[e[l-1]]+t.balanceSheetData["Equity Capital"][e[l-1]]);const i=t.profitData["Net Profit"][n]/t.profitData["EPS in Rs"][n],c=r/i;a[n]=isNaN(r)||!isFinite(r)?"":r.toFixed(2),o[n]=isNaN(i)||!isFinite(i)?"":i.toFixed(2),s[n]=isNaN(c)||!isFinite(c)?"":c.toFixed(2)}),t.profitData["Book value"]=a,t.profitData["No of outstanding shares"]=o,t.profitData["Book value per share"]=s,t}function growthTrend(t){const e={};return["Sales","OPM %","PE","Other income normal"].forEach(a=>{e[a]={};const o=Object.keys(t[a]),s=o.indexOf("TTM");let n=[3,5,7,10];o.length<4&&-1===s||o.length<5&&-1!==s?n.includes(2)||(n=[2,3,5,7,10]):"PE"!=a&&"OPM %"!=a||(n=[1,3,5,7,10]),n.forEach(n=>{1!==n&&"PE"!=a&&-1!==s&&o.splice(s,1);let l=o.length-n-1,r=o.length-1,i=o[l],c=o[r];if("PE"!=a||2!=n||i||(n=1,l=o.length-n-1,r=o.length-1,i=o[l],c=o[r]),i&&c){const o=t[a][i]?parseFloat(t[a][i]):0,s=t[a][c]?parseFloat(t[a][c]):0;let d;if(["Sales","Net Profit","Other income normal"].includes(a))d=o?100*(Math.pow(s/o,1/n)-1):0;else{const e=Object.values(t[a]).slice(l,r+1).filter(t=>t&&t>=0);d=e.length>0?parseFloat(math.mean(e)):NaN}e[a][`${n} Year`]=isNaN(d)||!isFinite(d)?"":d.toFixed(2)}else e[a][`${n} Year`]=""})}),findBestAndWorst(e)}function calculateMaxProfit(t,e,a){const o=(t,e)=>0===e?"":(t-e)/e,s=o(e,t),n=o(a,e);return isNaN(s)||isNaN(n)||!isFinite(s)||!isFinite(n)?"":Math.max(s,n)}function drawBestandWorstCase(){const t={};$("#profit-loss .data-table:first tr").each(function(e){const a=($(this).find("td.text button").text().trim()||$(this).find("td.text").text().trim()).replace(/\n|\s/g,"").replace(/-|\+/g,"");let o="",s="";if(Object.keys(globalDataObj.profitData.Sales).length>1)switch(a){case"Sales":const e=Object.values(globalDataObj.profitData.Sales),a=globalDataObj.profitData.Sales.TTM?e[e.length-2]:e[e.length-1],n=a*(1+globalDataObj.trends["Best sales growth"]/100),l=a*(1+globalDataObj.trends["Worst sales growth"]/100);t.predictedBestSales=n,t.predictedWorstSales=l,o=toLocaleStringRounded(n),s=toLocaleStringRounded(l);break;case"OperatingProfit":let[r,i]=calculateOperatingProfit(t,globalDataObj.trends["Best OPM %"],globalDataObj.trends["Worst OPM %"]);t.predictedBestOperatingProfit=r||0,t.predictedWorstOperatingProfit=i||0;let c=t.predictedBestSales-t.predictedBestOperatingProfit,d=t.predictedWorstSales-t.predictedBestOperatingProfit;$(this).prev("tr").prev("tr").find("td").last().text(toLocaleStringRounded(d)).prev("td").text(toLocaleStringRounded(c)),o=toLocaleStringRounded(t.predictedBestOperatingProfit),s=toLocaleStringRounded(t.predictedWorstOperatingProfit);break;case"OPM%":o=globalDataObj.trends["Best OPM %"]+"%",s=globalDataObj.trends["Worst OPM %"]+"%";break;case"Depreciation":const f=Object.values(globalDataObj.profitData.Depreciation),b=f[f.length-1]||0;t.predictedBestDepreciation=b,t.predictedWorstDepreciation=b,o=b,s=b;break;case"Interest":const p=Object.values(globalDataObj.profitData.Interest),u=p[p.length-1]||0;t.predictedBestInterest=u,t.predictedWorstInterest=u,o=u,s=u;break;case"Tax%":const g=Object.values(globalDataObj.profitData["Tax %"]),h=g[g.length-1]||g[g.length-2]||0;t.lastTax=h,o=h+"%",s=h+"%";break;case"OtherIncome":let m=Object.values(globalDataObj.profitData["Other income normal"]),v=0;v=globalDataObj.profitData["Other income normal"].TTM||""==globalDataObj.profitData["Other income normal"].TTM?m[m.length-2]:m[m.length-1],predictedBestOtherIncome=v+v*(globalDataObj.trends["Best other income normal growth"]/100),predictedWorstOtherIncome=v+v*(globalDataObj.trends["Worst other income normal growth"]/100),t.predictedBestOtherIncome=predictedBestOtherIncome,t.predictedWorstOtherIncome=predictedWorstOtherIncome,o=toLocaleStringRounded(predictedBestOtherIncome),s=toLocaleStringRounded(predictedWorstOtherIncome);break;case"Profitbeforetax":[o,s]=calculatePBT(t.predictedBestOperatingProfit,t.predictedBestOtherIncome,t.predictedBestDepreciation,t.predictedBestInterest,t.predictedWorstOperatingProfit,t.predictedWorstOtherIncome,t.predictedWorstDepreciation,t.predictedWorstInterest),t.bestPBT=parseInt(o.replace(/,/g,"")),t.worstPBT=parseInt(s.replace(/,/g,"")),$("#profit-loss table").eq(0).find('tbody tr td:contains("EBIT")').closest("tr").find("td").last().text(s).prev("td").text(o);break;case"NetProfit":const[x,D]=calculateNetProfit(t.bestPBT,t.worstPBT,t.lastTax);t.bestNetProfit=x,t.worstNetProfit=D,o=toLocaleStringRounded(x),s=toLocaleStringRounded(D);break;case"PATMargin%":[o,s]=calculatePATMargin(t.bestNetProfit,t.predictedBestSales,t.worstNetProfit,t.predictedWorstSales);break;case"EPSinRs":[o,s]=calculateEPS(t.bestNetProfit,t.worstNetProfit),t.bestEPS=o,t.worstEPS=s;break;case"Pricetoearning":o=isFinite(globalDataObj.trends["Best PE"])?globalDataObj.trends["Best PE"]:"",s=isFinite(globalDataObj.trends["Worst PE"])?globalDataObj.trends["Worst PE"]:"",t.bestPE=o,t.worstPE=s;break;case"Stockprice":[o,s]=calculatStockPrice(t.bestPE,t.worstPE,t.bestEPS,t.worstEPS),$('input[name="BestOPM"], input[name="WorstOPM"], input[name="BestPE"], input[name="WorstPE"]').on("keyup",function(t){t.target.value>100&&(t.target.value="100.00"),$(t.target).hasClass("OPM")&&t.target.value<0&&(t.target.value="00.00")}),$(".OPM").change(function(e){const{BestOPM:a,WorstOPM:o,BestPE:s,WorstPE:n}=getEditableInputValues(),[l,r]=calculateOperatingProfit(t,a,o);setText("Operating Profit",toLocaleStringRounded(l),toLocaleStringRounded(r));let i=0;l&&t.predictedBestDepreciation&&(i=toLocaleStringRounded(l-t.predictedBestDepreciation+t.predictedBestOtherIncome));let c=0;r&&t.predictedWorstDepreciation&&(c=toLocaleStringRounded(r-t.predictedWorstDepreciation+t.predictedWorstOtherIncome)),setText("EBIT",i,c);const[d,f]=calculatePBT(l,t.predictedBestOtherIncome,t.predictedBestDepreciation,t.predictedBestInterest,r,t.predictedWorstOtherIncome,t.predictedWorstDepreciation,t.predictedWorstInterest);setText("Profit before tax",d,f);const[b,p]=calculateNetProfit(parseInt(d.replace(/,/g,"")),parseInt(f.replace(/,/g,"")),t.lastTax);setText("Net Profit",toLocaleStringRounded(parseInt(b)),toLocaleStringRounded(parseInt(p)));const[u,g]=calculatePATMargin(b,t.predictedBestSales,p,t.predictedWorstSales);setText("Net Margin",u,g);const[h,m]=calculateEPS(b,p);t.bestEPS=h,t.worstEPS=m,setText("EPS in Rs",h,m);const[v,x]=calculatStockPrice(parseFloat(s).toFixed(2),parseFloat(n).toFixed(2),parseFloat(h).toFixed(2),parseFloat(m).toFixed(2));$("#profit-loss .data-table:first-child tbody tr:last-child td:nth-last-child(2)").text(v),$("#profit-loss .data-table:first-child tbody tr:last-child .orange-bg:last-child").text(x)}),$(".PE").change(function(e){const{BestPE:a,WorstPE:o}=getEditableInputValues(),[s,n]=calculatStockPrice(parseFloat(a).toFixed(2),parseFloat(o).toFixed(2),t.bestEPS,t.worstEPS);$("#profit-loss .data-table:first-child tbody tr:last-child td:nth-last-child(2)").text(s),$("#profit-loss .data-table:first-child tbody tr:last-child .orange-bg:last-child").text(n)})}let n="";n="Pricetoearning"==a?'<td class="green-bg"><input type="number" name="BestPE" value="'+o+'" class="PE"/></td><td class="orange-bg"><input type="number" name="WorstPE" value="'+s+'" class="PE"/></td>':"OPM%"==a?'<td style="padding: 0px !important; text-align: right;" class="green-bg"><input max="100.00" min="0.00" required type="number" name="BestOPM" value="'+parseFloat(o)+'" class="OPM"/>%</td><td style="padding: 0px !important; text-align: right;" class="orange-bg"><input max="100.00" min="0.00" required type="number" name="WorstOPM" value="'+parseFloat(s)+'" class="OPM"/>%</td>':`<td class='green-bg'>${o}</td><td class='orange-bg'>${s}</td>`,e?$(this).append(n):$(this).append('<th class="green-bg">Best Case<span class="has-tooltip">\n                    <i class= "icon-info" ></i>\n                    <span class="tooltip my-tooltip">\n                    Displays optimistic projections, using the highest growth trends in Sales, Net Profit & Other Income Normal, and average values for OPM and PE analyzed over 3, 5, 7, and 10 years.\n                    </span>\n                </span>\n                </th > <th class="orange-bg">Worst Case<span class="has-tooltip">\n                    <i class= "icon-info" ></i>\n                    <span class="tooltip my-tooltip">\n                    Displays cautious projections, utilizing the lowest growth trends in Sales, Net Profit & Other Income Normal, and the highest values for OPM and PE analyzed over 3, 5, 7, and 10 years.\n                    </span>\n                </span>\n                </th>')})}function getEditableInputValues(){return{BestOPM:$('input[name="BestOPM"]').val(),WorstOPM:$('input[name="WorstOPM"]').val(),BestPE:$('input[name="BestPE"]').val(),WorstPE:$('input[name="WorstPE"]').val()}}function setText(t,e,a){$("#profit-loss .data-table:first-child tbody td.text:contains("+t+")").closest("tr").find("td.green-bg").text(e),$("#profit-loss .data-table:first-child tbody td.text:contains("+t+")").closest("tr").find("td.orange-bg").text(a)}function toLocaleStringRounded(t){return"number"!=typeof t&&isNaN(t)?0:Math.round(t).toLocaleString("en-IN")}function toLocaleStringRoundedFloat(t){return"number"!=typeof t&&isNaN(t)?0:t.toLocaleString("en-IN")}function calculateOperatingProfit(t,e,a){return[parseInt(t.predictedBestSales*(parseFloat(e)/100)),parseInt(t.predictedWorstSales*(parseFloat(a)/100))]}function calculateNetProfit(t,e,a){let o=0,s=0;if(a<0){let n=t*(Math.abs(a)/100);o=t+n,s=e+n}else o=t-t*(a/100),s=e-e*(a/100);return[o,s]}function calculatStockPrice(t,e,a,o){let s=t>=0&&a>=0?t*a:"",n=e>=0||o>=0?e*o:"";return bestCaseVal=isFinite(s)&&s>0?toLocaleStringRounded(s):"",worstCaseVal=isFinite(n)&&n>0?toLocaleStringRounded(n):"",[bestCaseVal,worstCaseVal]}function calculatePBT(t,e,a,o,s,n,l,r){const i=s+n-l-r;return[toLocaleStringRounded(t+e-a-o),toLocaleStringRounded(i)]}function calculatePATMargin(t,e,a,o){return[parseFloat(t/e*100).toFixed(2)+"%",parseFloat(a/o*100).toFixed(2)+"%"]}function calculateEPS(t,e){const a=Object.values(globalDataObj.profitData["No of outstanding shares"]),o=a[a.length-1]||a[a.length-2]||1;return[(t/o).toFixed(2),(e/o).toFixed(2)]}function commonSizePnL(t){var e,a;"quarterly"==t?(e="quarters",a="common-qprofit-table"):(e="profit-loss",a="common-profit-table");var o=$("#"+e+" table.data-table:eq(0)"),s=[];$(o).find("tr").each(function(){var t=$(this).find("td, th").map(function(){return $(this).text().trim()}).get();s.push(t)});var n=function(t){return s.findIndex(function(e){return e.some(function(e){return e.includes(t)})})},l=-1!==n("Sales")?n("Sales"):n("Revenue"),r=n("Material Cost %"),i=n("Manufacturing Cost %"),c=n("Gross Margin %"),d=n("Net Profit"),f=n("Net Margin %"),b=n("Operating Profit"),p=n("Depreciation"),u=n("EBIT"),g=n("Other Income"),h=(n("Interest"),n("Book value per share")),m=n("Price to earning"),v=n("Stock price"),x=s[r],D=s[i],F=x?x.slice(1).map(function(t){return parseFloat(t.replace("%",""))}):Array(s[l]?.length)?.fill(0);D?D.slice(1).map(function(t){return parseFloat(t.replace("%",""))}):Array(F?.length)?.fill(0);if(globalDataObj.profitData.EBIT={},globalDataObj.profitData["Gross Margin %"]={},globalDataObj.profitData["Net Margin %"]={},$("#"+e+' .data-table:eq(0) td.text:contains("Gross Margin %")').closest("tr").find("td:not(:first)").each(function(a){let o=Object.keys(globalDataObj.profitData.Sales),n=100-F[a],r=o[a];globalDataObj.profitData["Gross Margin %"][r]=isNaN(n)?"":n,n=isNaN(n)?"":n.toFixed(2)+" % ",$(this).text(n),s[c][a+1]=n,$("#"+e+' .data-table:eq(0) td.text:contains("Gross Margin %")').closest("tr").find("td:not(:first)").eq(a).text(n);let i=parseInt(s[d][a+1].replace(/,/g,""))/parseInt(s[l][a+1].replace(/,/g,""))*100;i=i?i.toFixed(2):0,$("#"+e+' .data-table:eq(0) td.text:contains("Net Margin %")').closest("tr").find("td:not(:first)").eq(a).text(i+"%"),globalDataObj.profitData["Net Margin %"][r]=isNaN(i)?"":i,s[f][a+1]=i+" % ";let x=parseFloat(s[b][a+1].replace(/,/g,"")),D=parseFloat(s[p][a+1].replace(/,/g,"")),O=parseFloat(s[g][a+1].replace(/,/g,"")),y=0;if(x&&D&&(y=toLocaleStringRoundedFloat(x-D+O)),$("#"+e+' .data-table:eq(0) td.text:contains("EBIT")').closest("tr").find("td:not(:first)").eq(a).text(y),s[u][a+1]=y,globalDataObj.profitData.EBIT[r]=y?y.replace(/,/g,""):0,"yearly"==t){let t=Object.values(globalDataObj.profitData["Book value per share"])[a];$("#"+e+' .data-table:eq(0) td.text:contains("Book value per share")').closest("tr").find("td:not(:first)").eq(a).text(t),s[h][a+1]=t;let o="";r&&globalDataObj.profitData.PE[r]?o=globalDataObj.profitData.PE[r]:globalDataObj.profitData.PE[r]=o,$("#"+e+' .data-table:eq(0) td.text:contains("Price to earning")').closest("tr").find("td:not(:first)").eq(a).text(o),s[m][a+1]=o;let n="";r&&globalDataObj.priceData[r]?n=globalDataObj.priceData[r]:globalDataObj.priceData[r]=n,$("#"+e+' .data-table:eq(0) td.text:contains("Stock price")').closest("tr").find("td:not(:first)").eq(a).text(n),s[v][a+1]=n}}),-1!==l){var O=s[l].slice(1).map(function(t){return parseFloat(t.replace(/,/g,""))}),y=s.map(function(t,e){return t.map(function(t,a){if(e>l&&0!==a&&t&&!t.includes("%")){var o=t.replace(/,/g,"");if(o.trim()){var s=parseFloat(o);return s>=0?(s/O[a-1]*100).toFixed(2)+"%":"-"+(Math.abs(s)/O[a-1]*100).toFixed(2)+"%"}return"0%"}return t})});$.each(y[l].slice(1),function(t){y[l][t+1]="100%"}),$(o).clone().addClass(a+" hidden").insertAfter("#"+e+" .data-table"),y&&y.length>0&&$.each(y,function(t,e){$.each(e,function(e,o){"NaN%"==o&&(o=""),parseFloat(o),$($("."+a+" tr")[t]).find("td").eq(e).text(o)})})}}function commonSizeBalanceSheet(){const t=$("#balance-sheet .data-table:eq(0)"),{balanceSheetData:e,profitData:a}=globalDataObj;globalDataObj.ratios["Debt to Equity"]={},globalDataObj.ratios.ROE={},globalDataObj.ratios.ROA={},Object.keys(globalDataObj.balanceSheetData["Equity Capital"]).forEach((o,s)=>{const n=(e["Other Assets"][o]||0)-(e["Other Liabilities"][o]||0);t.find('td.text:contains("Working Capital")').closest("tr").find(`td:eq(${s+1})`).text(toLocaleStringRounded(n));let l=0;e["Trade receivables"]&&(l=e["Trade receivables"][o]&&e["Trade receivables"][o]||0),t.find('td.text:contains("Debtors")').closest("tr").find(`td:eq(${s+1})`).text(toLocaleStringRounded(l));const r=e.Inventories&&e.Inventories[o]||0;t.find('td.text:contains("Inventory")').closest("tr").find(`td:eq(${s+1})`).text(toLocaleStringRounded(r));const i=e.Borrowings[o]&&e.Borrowings[o]||0,c=(e["Equity Capital"][o]&&e["Equity Capital"][o]||0)+(e.Reserves[o]&&e.Reserves[o]||0),d=c?parseFloat(i/c).toFixed(2):"";t.find('td.text:contains("Debt to Equity")').closest("tr").find(`td:eq(${s+1})`).text(d);const f=a["Book value"][o]||0,b=a["Net Profit"][o]||0;globalDataObj.ratios["Debt to Equity"][o]=d,ROE=f>0?parseFloat(b/f*100).toFixed(2):"",t.find('td.text:contains("ROE")').closest("tr").find(`td:eq(${s+1})`).text(ROE+"%"),globalDataObj.ratios.ROE[o]=ROE;const p=e["Total Assets"][o]||0;ROA=p>0?parseFloat(b/p*100).toFixed(2):"",t.find('td.text:contains("ROA")').closest("tr").find(`td:eq(${s+1})`).text(ROA+"%"),globalDataObj.ratios.ROA[o]=ROA});var o=[];$('#balance-sheet .data-table td.text:contains("Total Liabilities")').closest("tr").find("td:not(:first)").each(function(t){var e=parseFloat($(this).text().replace(/,/g,""));o[t]=e});var s=[...o],n=$('#balance-sheet .data-table td.text:contains("Total Liabilities")').closest("tr").prevAll(),l=$('#balance-sheet .data-table td.text:contains("Total Liabilities")').closest("tr").nextAll().not(":last"),r=n.first().find("td").length,i=[];if(n.each(function(){var t=$(this);liabilitiesRowsValues=t.find("td").map(function(){return $(this).text()}).get();for(var e=1;e<r;e++){var a,s=parseFloat(liabilitiesRowsValues[e].replace(/,/g,""));isNaN(s)?liabilitiesRowsValues[e]="":(a=s>=0?s/o[e-1]*100:Math.abs(s)/o[e-1]*-1*100,liabilitiesRowsValues[e]=a.toFixed(2)+"%")}i.push(liabilitiesRowsValues)}),i=i.reverse(),r>1){var c=Array(r-1).fill("100%");c.unshift("Total Liabilities"),i.push(c)}var d=[];l.each(function(){var t=$(this);assetsRowsValues=t.find("td").map(function(){return $(this).text()}).get();for(var e=1;e<r;e++){var a,o=parseFloat(assetsRowsValues[e].replace(/,/g,""));isNaN(o)?assetsRowsValues[e]="":(a=o>=0?o/s[e-1]*100:Math.abs(o)/s[e-1]*-1*100,assetsRowsValues[e]=a.toFixed(2)+"%")}d.push(assetsRowsValues)});var f=Array(r-1).fill("100%");f.unshift("Total Assets"),d.push(f);let b=$.merge(i,d);0==$(".common-balance-table").length&&$("#balance-sheet table.data-table:eq(0)").clone().addClass("common-balance-table hidden").insertAfter("#balance-sheet .data-table"),b&&b.length>0&&$.each(b,function(t,e){$.each(e,function(e,a){0!=e?("NaN%"==a&&(a=""),parseFloat(a),$($($(".common-balance-table tbody tr")[t]).find("td")[e]).text(a)):$($($(".common-balance-table tbody tr")[t]).find("td")[e]).text(a)})})}function addNewRows(){["quarterly","yearly"].forEach(t=>{var e,a;"quarterly"==t?(e="quarters",a="common-qprofit-table"):(e="profit-loss",a="common-profit-table");var o=$("#"+e+" table.data-table:eq(0)"),s=o.find('td.text:contains("OPM %")').closest("tr"),n=s.clone().addClass("custom-row").insertBefore(o.find('td.text:contains("Operating Profit")').closest("tr").removeClass("stripe"));n.find('td.text:contains("OPM %")').text("Gross Margin %");var l=s.clone().addClass("custom-row").insertBefore(o.find('td.text:contains("EPS in Rs")').closest("tr").addClass("strong").removeClass("stripe"));l.find('td.text:contains("OPM %")').text("Net Margin %"),n.find("td:not(:first)").text(""),l.find("td:not(:first)").text("");var r=s.clone().addClass("custom-row strong").insertAfter(s);if(r.find('td.text:contains("OPM %")').last().text("EBIT").attr("title","Profit before interest and tax"),r.find("td").slice(1).text(""),"yearly"==t){var i=o.find('td.text:contains("EPS in Rs")').closest("tr").removeClass("stripe"),c=i.clone().addClass("stripe").removeClass("strong").insertAfter(i);c.find('td.text:contains("EPS in Rs")').last().text("Book value per share"),c.find("td:not(:first)").text("");var d=o.find('td.text:contains("Dividend Payout %")').closest("tr"),f=d.clone().addClass("stripe strong").insertAfter(d);f.find('td.text:contains("Dividend Payout %")').last().text("Price to earning"),f.find("td:not(:first)").text("");var b=o.find('td.text:contains("Price to earning")').closest("tr").addClass("custom-row");b.clone().removeClass("stripe").insertBefore(b),b.find('td.text:contains("Price to earning")').last().text("Stock price").closest("tr").addClass("strong").removeClass("stripe custom-row"),b.find("td:not(:first)").text("")}var p="quarterly"==t?"#quarters":"#profit-loss",u="quarterly"==t?"#quarters .flex.flex-gap-8":"#profit-loss .flex.flex-gap-8";$(`<div class="flex flex-gap-8 ${p.substring(1)}" style="justify-content: flex-end; align-items: center;">\n         <div class="options small margin-0">\n            <button class="normal-size active" type="button">Normal Size</button>\n            <button class="common-size" type="button">Common Size</button>\n         </div>\n      </div>`).insertAfter(u),$(document).on("click",`${p} .options button`,function(t){$(`${p} button`).removeClass("active"),$(t.target).addClass("active"),$(t.target).hasClass("normal-size")?($(`#${e} table.data-table:first-child`).show(),$(`#${e} table.${a}`).hide()):($(`#${e} table.data-table:first-child`).hide(),$(`#${e} table.${a}`).show())})});var t=$("#balance-sheet table.data-table:eq(0)").find('td.text:contains("Total Assets")').closest("tr"),e=t.clone().addClass("custom-row").insertAfter(t);e.find('td.text:contains("Total Assets")').last().text("Working Capital").attr("title","Other Assets - Other Liabilities"),e.removeClass("strong").find("td").slice(1).text("");var a=t.clone().removeClass("strong").insertAfter(e);a.find('td.text:contains("Total Assets")').last().text("Debtors"),a.find("td").slice(1).text("");var o=t.clone().removeClass("strong").addClass("stripe").insertAfter(a);o.find('td.text:contains("Total Assets")').last().text("Inventory"),o.find("td").slice(1).text("");var s=t.clone().removeClass("strong").insertAfter(o);s.find('td.text:contains("Total Assets")').last().text("Debt to Equity"),s.find("td").slice(1).text("");var n=t.clone().addClass("custom-row").insertAfter(s);n.find('td.text:contains("Total Assets")').last().text("ROE"),n.find("td").slice(1).text("");var l=t.clone().removeClass("strong").insertAfter(n);l.find('td.text:contains("Total Assets")').last().text("ROA"),l.find("td").slice(1).text(""),$('<div class="flex flex-gap-8 balance-size" style="justify-content: flex-end; align-items: center;">\n            <div class="options small margin-0">\n            <button class="normal-size active" type="button">Normal Size</button>\n            <button  class="common-size" type="button">\n                Common Size\n            </button>\n            </div>\n        </div>').insertAfter("#balance-sheet .flex.flex-gap-8"),$(document).on("click",".balance-size button",function(t){if($(".balance-size button").removeClass("active"),$(t.target).addClass("active"),$(t.target).hasClass("normal-size"))$("#balance-sheet table.data-table").show(),$("#balance-sheet table.common-balance-table").hide();else{let t=$(".common-balance-table").find('td.text:contains("Working Capital")').closest("tr");t.nextAll().remove(),t.remove(),$("#balance-sheet table.data-table").hide(),$("#balance-sheet table.common-balance-table").show()}}),$('<div class="flex flex-gap-8 ratio-custom" style="justify-content: flex-end; align-items: center;">\n            <div class="options small margin-0">\n            <button  class="ratio-btn active" type="button">Ratios</button>\n            <button class="custom-ratio-btn" type="button">Ratio Analysis</button>\n            </div>\n        </div>').insertAfter("#ratios .flex.flex-gap-8"),$(document).on("click",".ratio-custom button",function(t){$(".ratio-custom button").removeClass("active"),$(t.target).addClass("active"),$(t.target).hasClass("ratio-btn")?($("#ratios table.data-table").show(),$("#ratios table.ratio-analysis-table").hide()):($("#leverageRatio").length||(addRatioAnalysis(),styleRows()),$("#ratios table.data-table").hide(),$("#ratios table.ratio-analysis-table").show())})}function findBestAndWorst(t){const e=t;for(const a in t){const o=Object.values(t[a]).map(t=>"string"==typeof t?parseFloat(t):t).filter(t=>"number"==typeof t&&!isNaN(t)),s=Math.max(...o),n=Math.min(...o);e[`Best ${"Sales"==a||"Other income normal"==a?a.toLowerCase()+" growth":a}`]=s.toFixed(2),e[`Worst ${"Sales"==a||"Other income normal"==a?a.toLowerCase()+" growth":a}`]=n.toFixed(2)}return e}function calculateDaysPassed(){let t=$("#profit-loss .data-table:first thead tr th").not(".text").first().text().trim();const e=new Date,a=parseInt(t.split(" ")[1]),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(t.split(" ")[0]),s=e-new Date(a,o,10);return Math.floor(s/864e5)}function calculateDynamicCumulativeCashFlow(t,e,a){const o=Object.values(t[e]),s=Math.max(0,o.length-a),n=o.length-1,l=o.slice(s,n+1).filter(t=>"number"==typeof t).reduce((t,e)=>t+e,0);return l}function calculateCumulativeCashFlows(t,e){const a={};for(const o in t)a[o]=calculateDynamicCumulativeCashFlow(t,o,e);return a}function calculateCashFlowCAGR(t,e,a){const o=Object.keys(t[e]);if(o.length<a)return console.log(`Not enough data to calculate ${a}-year CAGR for ${e}`),null;const s=o[o.length-1],n=o[o.length-a],l=t[e][s],r=t[e][n];return r>0&&l>0&&l>=r?100*((l/r)**(1/a)-1):r>0&&l>0&&l<r?100*-((r/l)**(1/a)-1):r<0&&l>0?100*(((l-r)/Math.abs(r))**(1/a)-1):r<0&&l<0&&l>r?100*((Math.abs(l)/Math.abs(r))**(1/a)-1):r<0&&l<0&&l<r?100*-((Math.abs(r)/Math.abs(l))**(1/a)-1):r>0&&l<0?100*-(((r-l)/r)**(1/a)-1):null}$(document).ready(function(){try{fetch("https://cdn.jsdelivr.net/gh/getsam123/analyser@fc2501878edd8e5e02edab8e901d1fb6427f2da9/sectors.json").then(t=>t.json()).then(t=>{if(t){let e="";const a=$(".desktop-links .dropdown-menu").clone();t.forEach(t=>{e+=` <li> <a style="color:var(--link);padding-bottom: 10px;" href="https://www.screener.in/company/compare/${t.link}" class="flex flex-align-center flex-gap-16 font-weight-500 font-size-14">${t.sectorName}</a> </li>`}),a.find(".button-plain").html('Sectors <i class="icon-down"></i>'),a.find("ul.dropdown-content").html(e).css({height:"500px",overflow:"auto"}),a.insertAfter(".desktop-links .dropdown-menu")}}).catch(t=>{console.error("Error fetching JSON:",t)});"Revenue"!==$('#profit-loss .data-table:first-child tbody tr:first-child td.text:contains("Revenue")').text().trim()&&$(".company-links").append('\n             <a href="javascript:void(0)" class="custom_ratios">\n                <i class="icon-screens" ></i><span style="font-size: 1.8rem;margin-left:2px">Smart Analyze</span>\n             </a>');const t=t=>new Promise(e=>setTimeout(e,t));$(document).on("click",".custom_ratios",function(e){const a=$(".custom_ratios");a.removeClass("custom_ratios").css("cursor","default"),a.append('<div class="loader"></div>'),globalDataObj={},e.preventDefault();$("head").append('<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/getsam123/analyser@fc2501878edd8e5e02edab8e901d1fb6427f2da9/style.css" media="all">'),async function(){const e=$("#quarters .data-table:first-child .blue-icon, #profit-loss .data-table:first-child .blue-icon, #balance-sheet .data-table:first-child .blue-icon, #cash-flow .data-table:first-child .blue-icon");e.each(function(){this.click()}),await t(1e3);const a=Array.from(document.querySelectorAll("button[onclick^='Company.showSchedule']")).find(t=>t.innerText.trim().startsWith("Trade receivables"));a?(a.click(),await t(1e3)):console.warn("❗ 'Trade receivables' button not found."),setTimeout(async()=>{try{globalDataObj=await collectDataInObject(),addNewRows(),commonSizePnL("quarterly"),commonSizePnL("yearly"),commonSizeBalanceSheet(),e.each(function(){this.click()}),drawBestandWorstCase(),styleRows(),$(".loader").remove(),$(".company-links a:last-child").attr("style","color: var(--link-mute);cursor: default"),addReverseDCF()}catch(t){e.each(function(){this.click()}),console.log(t),$(".loader").remove(),$(".company-links a:last-child").attr("style","color: var(--link-mute);cursor: default")}},1e3)}()})}catch(t){console.log(t)}});const average=t=>{const e=t.filter(t=>null!=t);return e.length?e.reduce((t,e)=>t+e,0)/e.length:null},stdDev=t=>{const e=t.filter(t=>null!=t),a=average(e);return Math.sqrt(average(e.map(t=>(t-a)**2)))},median=t=>{const e=t.filter(t=>null!=t).sort((t,e)=>t-e),a=Math.floor(e.length/2);return e.length%2==0?(e[a-1]+e[a])/2:e[a]},sum=t=>t.filter(t=>null!=t).reduce((t,e)=>t+e,0),toPercent=t=>null==t?null:(100*t).toFixed(2),redFlag=(val,condition)=>{if(null==val)return null;try{return eval(condition.replace(/x/g,val))?"🔹 Yes":"No"}catch{return null}},getMovingWindowRatios=(t,e,a)=>{const o=[];for(let s=0;s<=t.length-a;s++){const n=t.slice(s,s+a).filter(t=>null!=t),l=e.slice(s,s+a).filter(t=>null!=t);if(n.length<a||l.length<a){o.push(null);continue}const r=sum(n),i=sum(l);o.push(i?r/i:null)}return o},getSixYearCfoCfiToRevenueRatios=(t,e,a)=>{const o=[];for(let s=0;s<=t.length-6;s++){const n=t.slice(s,s+6).filter(t=>null!=t),l=e.slice(s,s+6).filter(t=>null!=t),r=a.slice(s,s+6).filter(t=>null!=t);if(n.length<6||l.length<6||r.length<6){o.push(null);continue}const i=sum(n.map((t,e)=>t+l[e])),c=median(r),d=c?i/c:null;o.push(d)}return o};function generateForensicRatioTable(t){const e=document.createElement("table");e.className="ratio-analysis-table hidden",e.setAttribute("id","forensicRatio");const a=document.createElement("thead"),o=document.createElement("tr");for(const e of Object.keys(t)){const t=document.createElement("th");t.textContent=e,o.appendChild(t)}a.appendChild(o),e.appendChild(a);const s=document.createElement("tbody"),n=document.createElement("tr");for(const e of Object.keys(t)){const a=document.createElement("td");a.textContent=t[e].Value;const o=t[e]["Red Flag"];a.style.backgroundColor="string"==typeof o&&o.toLowerCase().includes("yes")?"#ffcccc":"#ccffcc",a.style.textAlign="center",n.appendChild(a)}return s.appendChild(n),e.appendChild(s),e}function addForensicRations(){const t=Object.values(globalDataObj.profitData.Sales||{}),e=Object.values(globalDataObj.profitData["Operating Profit"]||{}),a=Object.values(globalDataObj.profitData.Depreciation||{}),o=Object.values(globalDataObj.profitData["Net Profit"]||{}),s=Object.values(globalDataObj.profitData["Profit before tax"]||{}),n=(Object.values(globalDataObj.cashFlowData["Dividends paid"]||{}),Object.values(globalDataObj.profitData["Other Cost %"]||{})),l=Object.values(globalDataObj.cashFlowData["Direct taxes"]||{}),r=Object.values(globalDataObj.cashFlowData["Cash from Operating Activity"]||{}),i=Object.values(globalDataObj.cashFlowData["Cash from Investing Activity"]||{}),c=Object.values(globalDataObj.balanceSheetData.Reserves||{}),d=Object.values(globalDataObj.balanceSheetData["Equity Capital"]||{}),f=Object.values(globalDataObj.balanceSheetData.CWIP||{}),b=Object.values(globalDataObj.balanceSheetData["Gross Block"]||{}),p=Object.values(globalDataObj.balanceSheetData["Accumulated Depreciation"]||{}),u=Object.values(globalDataObj.balanceSheetData["Prov for Doubtful"]||{}).map(t=>null!=t?Math.abs(t):null),g=Object.values(globalDataObj.balanceSheetData["Receivables over 6m"]||{}),h=Object.values(globalDataObj.cashFlowData["Interest received"]||{}),m=Object.values(globalDataObj.balanceSheetData.Investments||{}),v=Object.values(globalDataObj.balanceSheetData["Cash Equivalents"]||{}),x=(b.map((t,e)=>null!=t&&null!=p[e]?t-p[e]:null),d.map((t,e)=>null!=t&&null!=c[e]?t+c[e]:null),b.map((t,e)=>t+(f[e]||0)),s.map((t,e)=>null!=t&&null!=o[e]?t-o[e]:null)),D=getMovingWindowRatios(r,e,6),F=median(D),O=redFlag(F,"x < 0.5"),y=a.map((t,e)=>{const a=b.slice(e-1,e+1).filter(t=>null!=t);return 2===a.length?t/average(a):null}),w=stdDev(y),C=redFlag(w,"x > 0.2"),P=sum(u),E=sum(g),R=E?P/E:null,j=redFlag(R,"x < 0.1"),q=o.slice(1).reduce((t,e)=>t+e,0),S=c[c.length-1]-c[0],A=q?S/q:null,M=redFlag(A,"x < 1"),N=h.map((t,e)=>{const a=(m[e]||0)+(v[e]||0);return a?t/a:null}),T=median(N.slice(-6)),I=redFlag(T,"x < 0.05"),B=median(n),k=redFlag(B,"x > 5"),L=f.map((t,e)=>null!=t&&null!=b[e]?t/b[e]:null),V=median(L),W=redFlag(V,"x > 0.3"),G=getSixYearCfoCfiToRevenueRatios(r,i,t),Y=median(G),z=redFlag(Y,"x < 0.1"),H=[O,C,j,M,I,k,W,z],J=(H.filter(t=>"🔹 Yes"===t).length/H.length*100).toFixed(2),_=redFlag(J,"x > 70"),U=sum(l),K=sum(x),Q=K?U/K:null,X=redFlag(Q,"x > 0.6"),Z={"Cum CFO / EBITDA (6Y window median)":{Value:toPercent(F),"Red Flag":O},"Depreciation Rate Volatility":{Value:toPercent(w),"Red Flag":C},"Provision/Receivables > 6m":{Value:toPercent(R),"Red Flag":j},"Δ Reserves / (PAT + Dividend)":{Value:toPercent(A),"Red Flag":M},"Cash Yield":{Value:toPercent(T),"Red Flag":I},"Other Cost %":{Value:B,"Red Flag":k},"CWIP / Gross Block (6Y median)":{Value:toPercent(V),"Red Flag":W},"(CFO + CFI) / Median Revenue (6Y window median)":{Value:toPercent(Y),"Red Flag":z},"Cash tax/Income tax":{Value:toPercent(Q),"Red Flag":X},"Red Flag Score":{Value:J,"Red Flag":_}};var tt=$("#ratios .data-table:first-child"),et=generateForensicRatioTable(Z);tt.after(et);for(const t of Object.keys(Z))globalDataObj.ratios[t]=Z[t].Value}function addRatioAnalysis(){var t=$("#ratios .data-table:first-child");for(let e=0;e<6;e++){let a=t.clone().addClass("ratio-analysis-table hidden");a.find("tbody tr:not(:last)").remove(),a.find("tr td").text("");let o=a.insertAfter(t);switch(e){case 5:o.attr("id","forensicRatio"),o.find("thead tr th:first-child").html('<h3 class="ratio-label">Forensic Ratios</h3>');break;case 4:o.attr("id","leverageRatio"),o.find("thead tr th:first-child").html('<h3 class="ratio-label">Leverage Ratios</h3>');break;case 3:o.attr("id","efficiencyRatio"),o.find("thead tr th:first-child").html('<h3 class="ratio-label">Efficiency Ratios</h3>');break;case 2:o.attr("id","profitabilityRatio"),o.find("thead tr th:first-child").html('<h3 class="ratio-label">Profitability Ratios</h3>');break;case 1:o.attr("id","capitalAllocationRatio"),o.find("thead tr th:first-child").html('<h3 class="ratio-label">Capital Allocation Ratios</h3>');break;case 0:o.attr("id","valuationRatio"),o.find("thead tr th:first-child").html('<h3 class="ratio-label">Valuation Ratios</h3>')}}const e={leverageRatio:["Debt/Equity","Debt/Assets","Debt/Ebitda","Debt/Capital Ratio","Cash Flow/Debt","Interest Coverage Ratio","Sales Change","Ebit Change","Operating Leverage","Financial Leverage","Debt Burden Ratio"],efficiencyRatio:["Receivable Days","Receivable Turnover","Inventory Days","Inventory Turnover","Net Fixed Assets Turnover","Sales/Capital Employed","Total Asset Turnover"],profitabilityRatio:["Ebitda","Ebitda Margin","Gross Profit","Gross Profit Margin","EBIT","EBIT Margin","Net Profit Margin","EPS","EPS Growth","Du Pont ROE","ROE","Net profit margin","Asset Turnover","Financial Leverage","DU PONT ROA","ROA","Net profit margin ","Asset Turnover"],capitalAllocationRatio:["ROCE","EBIT Margin","Sales/Cap Employed","NOPAT","Capital Employed","ROIC","ROIIC"],valuationRatio:["Price/Earnings","Price/Book","Price/CashFlow","Price/Sales","Enterprise Value","EV/EBITDA"],forensicRatio:["Cum CFO / EBITDA (6Y window median)","Depreciation Rate Volatility","Provision/Receivables > 6m","Δ Reserves / (PAT + Dividend)","Cash Yield","Other Cost %","CWIP / Gross Block (6Y median)","(CFO + CFI) / Median Revenue (6Y window median)","Red flag score"]};for(let t=0;t<e.profitabilityRatio.length;t++){if(t<e.leverageRatio.length-1){let t=$("table#leverageRatio tbody tr:first-child").clone();$("table#leverageRatio").find("tbody").append(t)}if(t<e.efficiencyRatio.length-1){let t=$("table#efficiencyRatio tbody tr:first-child").clone();$("table#efficiencyRatio").find("tbody").append(t)}if(t<e.profitabilityRatio.length-1){let t=$("table#profitabilityRatio tbody tr:first-child").clone();$("table#profitabilityRatio").find("tbody").append(t)}if(t<e.capitalAllocationRatio.length-1){let t=$("table#capitalAllocationRatio tbody tr:first-child").clone();$("table#capitalAllocationRatio").find("tbody").append(t)}if(t<e.valuationRatio.length-1){let t=$("table#valuationRatio tbody tr:first-child").clone();$("table#valuationRatio").find("tbody").append(t)}if(t<e.forensicRatio.length-1){let t=$("table#forensicRatio tbody tr:first-child").clone();$("table#forensicRatio").find("tbody").append(t)}}const a=$("table#leverageRatio tbody tr"),o=$("table#efficiencyRatio tbody tr"),s=$("table#profitabilityRatio tbody tr"),n=$("table#capitalAllocationRatio tbody tr"),l=$("table#valuationRatio tbody tr"),r=$("table#forensicRatio tbody tr"),i=["Debt to Assets","Debt to Ebitda","Debt to Capital","Cash Flow to Debt","Interest Coverage","Sales Change","Ebit Change","Operating Leverage","Financial Leverage","Debt Burden","Receivable Turnover","Inventory Turnover","Net Fixed Assets Turnover","Sales to Capital Employed","Total Asset Turnover","Ebitda","Ebitda Margin","Gross Profit","Gross Profit Margin","Ebit","Ebit Margin","Net Profit Margin","EPS","EPS Growth %","ROA","NOPAT","Capital Employed","ROIC %","ROIIC %","PE","PB","Price to CashFlow","Market Cap to Sales","Enterprise Value","EV to EBITDA"];for(const t of i)globalDataObj.ratios[t]={};addForensicRations(),globalDataObj.balanceSheetData["Market Cap"]={},globalDataObj.balanceSheetData["Enterprise Value"]={};const c=Object.keys(globalDataObj.balanceSheetData["Equity Capital"]);e.profitabilityRatio.forEach((t,i)=>{if(i<e.leverageRatio.length&&a.eq(i).find("td:eq(0)").text(e.leverageRatio[i]),i<e.efficiencyRatio.length&&o.eq(i).find("td:eq(0)").text(e.efficiencyRatio[i]),i<e.profitabilityRatio.length&&s.eq(i).find("td:eq(0)").text(e.profitabilityRatio[i]),i<e.capitalAllocationRatio.length&&n.eq(i).find("td:eq(0)").text(e.capitalAllocationRatio[i]),i<e.valuationRatio.length&&l.eq(i).find("td:eq(0)").text(e.valuationRatio[i]),i<e.valuationRatio.length&&r.eq(i).find("td:eq(0)").text(e.forensicRatio[i]),c[i]){const t=c[i],e=globalDataObj.balanceSheetData.Borrowings[t]||0,r=globalDataObj.profitData["Book value"][t]||0;let d=0;globalDataObj.ratios["Debt to Equity"][t]?d=globalDataObj.ratios["Debt to Equity"][t]||0:(d=r?parseFloat(e/r).toFixed(2):"",globalDataObj.ratios["Debt to Equity"][t]=d),isFinite(d)||(d=0),a.eq(0).find("td:eq("+(i+1)+")").text(d);const f=globalDataObj.balanceSheetData["Total Assets"][t]||0;if(!globalDataObj.ratios["Debt to Assets"][t]){const o=f?parseFloat(e/f).toFixed(2):"";a.eq(1).find("td:eq("+(i+1)+")").text(o),globalDataObj.ratios["Debt to Assets"][t]=o}const b=globalDataObj.profitData["Operating Profit"][t]||0;if(!globalDataObj.ratios["Debt to Ebitda"][t]){const o=b?parseFloat(e/b).toFixed(2):"";a.eq(2).find("td:eq("+(i+1)+")").text(o),globalDataObj.ratios["Debt to Ebitda"][t]=o}const p=parseFloat(e)+parseFloat(r);if(!globalDataObj.ratios["Debt to Capital"][t]){let o=p?parseFloat(e/p).toFixed(2):0;o=parseFloat(100*o).toFixed(2)+"%",a.eq(3).find("td:eq("+(i+1)+")").text(o),globalDataObj.ratios["Debt to Capital"][t]=o}const u=globalDataObj.cashFlowData["Cash from Operating Activity"][t]||0;if(!globalDataObj.ratios["Cash Flow to Debt"][t]){const o=e?parseFloat(u/e).toFixed(2):0;a.eq(4).find("td:eq("+(i+1)+")").text(o),globalDataObj.ratios["Cash Flow to Debt"][t]=o}const g=globalDataObj.profitData.EBIT[t]||0,h=globalDataObj.profitData.Interest[t]||0;if(!globalDataObj.ratios["Interest Coverage"][t]){const e=h?parseFloat(g/h).toFixed(2):0;a.eq(5).find("td:eq("+(i+1)+")").text(e),globalDataObj.ratios["Interest Coverage"][t]=e}if(!globalDataObj.ratios["Sales Change"][t]){const e=(globalDataObj.profitData["Sales Growth %"][t]||0)+"%";a.eq(6).find("td:eq("+(i+1)+")").text(e),globalDataObj.ratios["Sales Change"][t]=e}if(!globalDataObj.ratios["Ebit Change"][t]){const e=c[i-1];let o=0;e&&(o=globalDataObj.profitData.EBIT[e]||0);let s=o?parseFloat((g-o)/o).toFixed(2):"";s=s?parseFloat(100*s).toFixed(2)+"%":"",a.eq(7).find("td:eq("+(i+1)+")").text(s),globalDataObj.ratios["Ebit Change"][t]=s}if(!globalDataObj.ratios["Operating Leverage"][t]){const e=parseFloat(globalDataObj.ratios["Sales Change"][t])||0;let o="";if(globalDataObj.ratios["Ebit Change"][t]){const a=parseFloat(globalDataObj.ratios["Ebit Change"][t])||0;o=e?parseFloat(a/e).toFixed(2):""}a.eq(8).find("td:eq("+(i+1)+")").text(o),globalDataObj.ratios["Operating Leverage"][t]=o}if(!globalDataObj.ratios["Financial Leverage"][t]){let e=r?parseFloat(f/r).toFixed(2):"";e=isFinite(e)?e:0,a.eq(9).find("td:eq("+(i+1)+")").text(e),globalDataObj.ratios["Financial Leverage"][t]=e}if(!globalDataObj.ratios["Debt Burden"][t]){const o=globalDataObj.cashFlowData["Free cash flow"][t]||0,s=e?parseFloat(o/e).toFixed(2):0;a.eq(10).find("td:eq("+(i+1)+")").text(s),globalDataObj.ratios["Debt Burden"][t]=s}if(globalDataObj.ratios["Debtor Days"][t]){const e=globalDataObj.ratios["Debtor Days"][t]||0;o.eq(0).find("td:eq("+(i+1)+")").text(e);const a=e?parseFloat(365/e).toFixed(2):"";o.eq(1).find("td:eq("+(i+1)+")").text(a),globalDataObj.ratios["Receivable Turnover"][t]=a}if(globalDataObj.ratios["Inventory Days"][t]){const e=globalDataObj.ratios["Inventory Days"][t]||0;o.eq(2).find("td:eq("+(i+1)+")").text(e);const a=e?parseFloat(365/e).toFixed(2):"";o.eq(3).find("td:eq("+(i+1)+")").text(a),globalDataObj.ratios["Inventory Turnover"][t]=a}const m=parseFloat(globalDataObj.profitData.Sales[t])||0,v=parseFloat(globalDataObj.balanceSheetData["Fixed Assets"][t])||0;if(!globalDataObj.ratios["Net Fixed Assets Turnover"][t]){const e=v?parseFloat(m/v).toFixed(2):"";o.eq(4).find("td:eq("+(i+1)+")").text(e),globalDataObj.ratios["Net Fixed Assets Turnover"][t]=e}if(!globalDataObj.ratios["Sales to Capital Employed"][t]){const e=p?parseFloat(m/p).toFixed(2):"";o.eq(5).find("td:eq("+(i+1)+")").text(e),globalDataObj.ratios["Sales to Capital Employed"][t]=e}if(!globalDataObj.ratios["Total Asset Turnover"][t]){const e=f?parseFloat(m/f).toFixed(2):"";o.eq(6).find("td:eq("+(i+1)+")").text(e),globalDataObj.ratios["Total Asset Turnover"][t]=e}s.eq(0).find("td:eq("+(i+1)+")").text(toLocaleStringRoundedFloat(b)),globalDataObj.ratios.Ebitda[t]=b;let x=globalDataObj.profitData["OPM %"][t]||"";x+="%",s.eq(1).find("td:eq("+(i+1)+")").text(x),globalDataObj.ratios["Ebitda Margin"][t]=x;let D=globalDataObj.profitData["Gross Margin %"][t]||"";grossProfitMargin=parseFloat(D).toFixed(2)+"%",s.eq(3).find("td:eq("+(i+1)+")").text(grossProfitMargin),globalDataObj.ratios["Gross Profit"][t]=grossProfitMargin;let F=D?parseFloat(m*(D/100)).toFixed(2):"";s.eq(2).find("td:eq("+(i+1)+")").text(toLocaleStringRoundedFloat(F)),globalDataObj.ratios["Gross Profit"][t]=F,s.eq(4).find("td:eq("+(i+1)+")").text(g),globalDataObj.ratios.Ebit[t]=g;let O=m?parseFloat(g/m).toFixed(2):"";O=parseFloat(100*O).toFixed(2)+"%",s.eq(5).find("td:eq("+(i+1)+")").text(O),globalDataObj.ratios["Ebit Margin"][t]=O;let y=globalDataObj.profitData["Net Margin %"][t]||"";netProfitMargin=y+"%",s.eq(6).find("td:eq("+(i+1)+")").text(netProfitMargin),globalDataObj.ratios["Net Profit Margin"][t]=y;let w=globalDataObj.profitData["EPS in Rs"][t]||"";s.eq(7).find("td:eq("+(i+1)+")").text(w),globalDataObj.ratios.EPS[t]=w;let C=0;const P=c[i-1];if(P){let t=globalDataObj.profitData["EPS in Rs"][P]||"";if(t){C=parseFloat(((w-t)/t*100).toFixed(2))}}s.eq(8).find("td:eq("+(i+1)+")").text(C+"%"),globalDataObj.ratios["EPS Growth %"][t]=C,s.eq(9).find("td:eq("+(i+1)+")").closest("tr").addClass("strong");let E=globalDataObj.ratios.ROE[t]||"";E+="%",s.eq(10).find("td:eq("+(i+1)+")").text(E),s.eq(11).find("td:eq("+(i+1)+")").text(y+"%");const R=globalDataObj.ratios["Total Asset Turnover"][t]||0;s.eq(12).find("td:eq("+(i+1)+")").text(R);const j=globalDataObj.ratios["Financial Leverage"][t]||0;s.eq(13).find("td:eq("+(i+1)+")").text(j),s.eq(14).find("td:eq("+(i+1)+")").closest("tr").addClass("strong");const q=globalDataObj.profitData["Net Profit"][t]||"",S=f?parseFloat((q/f*100).toFixed(2)):"";s.eq(15).find("td:eq("+(i+1)+")").text(S+"%"),globalDataObj.ratios.ROA[t]=S,s.eq(16).find("td:eq("+(i+1)+")").text(y+"%"),s.eq(17).find("td:eq("+(i+1)+")").text(R);const $=globalDataObj.ratios["ROCE %"][t]||"";n.eq(0).find("td:eq("+(i+1)+")").text($+"%"),n.eq(1).find("td:eq("+(i+1)+")").text(O);const A=globalDataObj.ratios["Sales to Capital Employed"][t]||0;n.eq(2).find("td:eq("+(i+1)+")").text(A);const M=globalDataObj.profitData["Tax %"][t]||0,N=parseFloat(g*((100-M)/100)).toFixed(2);n.eq(3).find("td:eq("+(i+1)+")").text(toLocaleStringRoundedFloat(N)),globalDataObj.ratios.NOPAT[t]=N;const T=globalDataObj.balanceSheetData["Cash Equivalents"][t]||0,I=parseFloat(p-T).toFixed(2);n.eq(4).find("td:eq("+(i+1)+")").text(toLocaleStringRoundedFloat(I)),globalDataObj.ratios["Capital Employed"][t]=I;let B=I?parseFloat(N/I).toFixed(2):"";B=parseFloat(100*B).toFixed(2),n.eq(5).find("td:eq("+(i+1)+")").text(B+"%"),globalDataObj.ratios["ROIC %"][t]=B;let k=0;if(P){const t=globalDataObj.ratios.NOPAT[P]||0,e=I-(globalDataObj.ratios["Capital Employed"][P]||0)||0;k=e?(N-t||0)/e:0}k=parseFloat(100*k).toFixed(2),n.eq(6).find("td:eq("+(i+1)+")").text(k+"%"),globalDataObj.ratios["ROIIC %"][t]=k;const L=globalDataObj.profitData.PE[t]||0;l.eq(0).find("td:eq("+(i+1)+")").text(L),globalDataObj.ratios.PE[t]=L;const V=globalDataObj.priceData[t]||0,W=globalDataObj.profitData["Book value per share"][t]||0;let G=W?parseFloat(V/W).toFixed(2):"";G=isNaN(G)?0:G,l.eq(1).find("td:eq("+(i+1)+")").text(G),globalDataObj.ratios.PB[t]=G;let Y=u?parseFloat(V/u).toFixed(2):"";Y=parseFloat(100*Y).toFixed(2),l.eq(2).find("td:eq("+(i+1)+")").text(Y),globalDataObj.ratios["Price to CashFlow"][t]=Y;const z=globalDataObj.profitData["No of outstanding shares"][t]||0,H=parseFloat(z*V).toFixed(2);globalDataObj.balanceSheetData["Market Cap"][t]=H;const J=m?parseFloat(H/m).toFixed(2):"";l.eq(3).find("td:eq("+(i+1)+")").text(J),globalDataObj.ratios["Market Cap to Sales"][t]=J;const _=parseFloat(H+(parseFloat(e)-parseFloat(T))).toFixed(2);globalDataObj.balanceSheetData["Enterprise Value"]=_,l.eq(4).find("td:eq("+(i+1)+")").text(toLocaleStringRounded(_)),globalDataObj.ratios["Enterprise Value"][t]=_;const U=b?parseFloat(_/b).toFixed(2):"";l.eq(5).find("td:eq("+(i+1)+")").text(U),globalDataObj.ratios["EV to EBITDA"][t]=U}})}function addReverseDCF(){let t=document.createElement("a");t.href="#reverse-dcf",t.innerHTML="Reverse DCF",contains(".company-nav .sub-nav a","Documents")[0].insertAdjacentElement("beforebegin",t);let e=document.createElement("section");e.id="reverse-dcf",e.className="card card-large",e.innerHTML='<div class="flex flex-space-between margin-bottom-16"> <h2 class="margin-0">Reverse DCF</h2><div class="flex flex-gap-8 dcf-custom" style="justify-content: flex-end; align-items: center;"> <div class="options small margin-0"> <button class="reverse-dcf-btn active" type="button">Reverse DCF</button> <button class="dcf-btn" type="button">DCF</button> </div> </div> </div> <div class=" flex-column"> <div class="show-more-box" style="flex-basis: auto; flex-grow: 0;"></div>\n        <div class="flex flex-gap-32 flex-column-mobile" id="reverse-dcf-form-wrapper">\n            <div class="responsive-holder reverse-dcf-form">\n                <div class="fcf-wrapper margin-bottom-16 margin-top-16">\n                    <label for="fcf" class="medium text-align-left" style="color: var(--ink-700);margin-bottom:4px;font-size: 15px;">Earnings\n                        <span class="has-tooltip">\n                            <i class="icon-info"></i>\n                            <span class="tooltip my-tooltip">\n                            Use current year\'s FCF, If it\'s negative consider using an average FCF from the last 3 years. Alternatively, you may use EBITDA or Net Profit as a starting point.\n                            </span>\n                        </span>\n                    </label> <input required max="100000" type="number" class="u-full-width" id="fcf">\n                    <p class="error-wrapper hidden"><span class="error-message">Note:</span>  Reverse DCF doesn\'t work with negative Free Cash Flow. Please use Avg 3year\'s FCF or EBITDA or Net Profit as alternative in such scenarios.</p>\n                </div>\n                <div class="discount-rate-wrapper margin-bottom-16">\n                    <label for="discount-rate" class="medium" style="color: var(--ink-700);margin-bottom:4px;font-size: 15px;">Discount Rate (%)\n                        <span class="has-tooltip">\n                            <i class="icon-info"></i>\n                            <span class="tooltip my-tooltip">\n                            Your expected annual return rate, It helps us estimate today\'s value of future money.\n                            </span>\n                        </span>\n                    </label> <input type="number" class="u-full-width" id="discount-rate">\n                </div>\n                <div class="earning-growth-wrapper margin-bottom-16 hidden">\n                    <label for="earning-growth" class="medium" id="earningGrowth" style="color: var(--ink-700);margin-bottom:4px;font-size: 15px;">Earning Growth Rate (%)\n                        <span class="has-tooltip">\n                            <i class="icon-info"></i>\n                            <span class="tooltip my-tooltip">\n                            Estimate of how much the business is expected to grow its earnings.\n                            </span>\n                        </span>\n                    </label> <input type="number" class="u-full-width" id="earning-growth">\n                </div>\n                <div class="terminal-rate-wrapper margin-bottom-16">\n                    <label for="terminal-rate" class="medium" style="color: var(--ink-700);margin-bottom:4px;font-size: 15px;">Terminal Growth Rate (%)\n                        <span class="has-tooltip">\n                            <i class="icon-info"></i>\n                            <span class="tooltip my-tooltip">\n                            The steady rate at which your profit is expected to grow annually in the long-term future.\n                            </span>\n                        </span>\n                    </label> <input type="number" class="u-full-width" id="terminal-rate">\n                </div>\n\n                <div class="years-wrapper margin-bottom-16">\n                    <label for="years" class="medium" style="color: var(--ink-700);margin-bottom:4px;font-size: 15px;">No Of Years</label>\n                    <select id="years" name="years">\n                    </select>\n                </div>\n\n                <div class="terminal-multiple-wrapper margin-bottom-16">\n                    <label for="terminal-multiple" class="medium" id="noYearTMLabel" style="color: var(--ink-700);margin-bottom:4px;font-size: 15px;">10 Year Terminal Multiple\n                        <span class="has-tooltip">\n                            <i class="icon-info"></i>\n                            <span class="tooltip my-tooltip">\n                            Estimate of how much the business might be worth in the future, expressed as a multiple of its earnings.\n                            </span>\n                        </span>\n                    </label> <input type="number" class="u-full-width" id="terminal-multiple">\n                </div>\n\n                <div class="calculate-btn-wrapper margin-top-24 text-align-right">\n                    <button id="calculate-reverse-dcf" class="a2hs button-secondary button-small">\n                        Calculate\n                    </button>\n                </div>\n            </div>\n            <div class="responsive-holder" id="fcf-growth">\n            </div>\n            <div class="responsive-holder" id="result-wrapper">\n            </div>\n\n        </div>\n    </div >\n\n  </div>',document.getElementById("shareholding").insertAdjacentElement("afterend",e);const a=document.querySelector(".dcf-custom"),o=document.getElementById("years");for(let t=1;t<=30;t++){const e=document.createElement("option");e.value=t,e.textContent=t,10===t&&(e.selected=!0),o.appendChild(e)}document.getElementById("years").addEventListener("change",function(t){const e=$("#noYearTMLabel .small.inserts").text();document.getElementById("noYearTMLabel").innerHTML=`${t.target.value} Year Terminal Multiple`,$("#noYearTMLabel").append(`<span class="has-tooltip">\n        <i class="icon-info"></i>\n        <span class="tooltip my-tooltip">\n        Estimate of how much the business might be worth in the future, expressed as a multiple of its earnings.\n        </span>\n    </span><span class="small inserts" style="font-size: 11px;margin-left:5px;"> ${e}</span>`)});const s=globalDataObj.cashFlowData["Free cash flow"],n=globalDataObj.balanceSheetData["Equity Capital"],l=parseFloat(calculateAverageFCF(Object.values(s)).toFixed(2));l<0&&$(".error-wrapper").removeClass("hidden");const r=Object.keys(n)[Object.keys(n).length-1],i=parseFloat(contains("#top-ratios li span","Face Value")[0].nextElementSibling.querySelector("span").textContent.replace(/,/g,"")),c=n[r]/i,d=parseFloat(contains("#top-ratios li span","Market Cap")[0].nextElementSibling.querySelector("span").textContent.replace(/,/g,"")),f=parseFloat(contains("#top-ratios li span","Current Price")[0].nextElementSibling.querySelector("span").textContent.replace(/,/g,"")),b=parseFloat(parseFloat(c).toFixed(2));document.getElementById("fcf").value=Math.round(l),document.getElementById("discount-rate").value=parseFloat(10..toFixed(2)),document.getElementById("terminal-rate").value=parseFloat(2..toFixed(2)),document.getElementById("fcf").addEventListener("input",function(t){t.target&&"fcf"===t.target.id&&(t.target.value>0?($("#noYearTMLabel .small.inserts").remove(),$(".error-wrapper").addClass("hidden"),p=d?Math.round(d/t.target.value):0,$("#noYearTMLabel").append(`<span class="small inserts" style="font-size: 11px;margin-left:5px;"> Current Terminal Multiple is ${p}</span>`),u=parseInt(.75*p),document.getElementById("terminal-multiple").value=u):$(".error-wrapper").removeClass("hidden"))});let p=d?Math.round(d/Math.round(l)):0,u=parseInt(.75*p);$("#noYearTMLabel .small.inserts").remove(),$("#noYearTMLabel").append(`<span class="small inserts" style="font-size: 11px;margin-left:5px;"> Current Terminal Multiple is ${p}</span>`),document.getElementById("terminal-multiple").value=u,a.addEventListener("click",function(t){if(document.querySelector("#fcf-growth table")?.remove(),document.querySelector("#result-wrapper table")?.remove(),t.target.classList.contains("reverse-dcf-btn"))t.target.classList.add("active"),document.querySelector(".dcf-btn").classList.remove("active"),document.querySelector("#reverse-dcf .flex.flex-space-between.margin-bottom-16 h2").innerHTML="Reverse DCF",document.querySelector(".terminal-multiple-wrapper").style.display="block",document.querySelector(".earning-growth-wrapper").style.display="none";else if(t.target.classList.contains("dcf-btn")){t.target.classList.add("active"),document.querySelector(".reverse-dcf-btn").classList.remove("active"),document.querySelector("#reverse-dcf .flex.flex-space-between.margin-bottom-16 h2").innerHTML="DCF",document.querySelector(".terminal-multiple-wrapper").style.display="none",document.querySelector(".earning-growth-wrapper").style.display="block";const e=parseInt(document.getElementById("years").value);let a=10;e<4?a=3:e<6?a=5:e<8&&(a=7);let o=Math.round(globalDataObj.cashFlowData["Free cash flow Growth"][a]);o<=0&&(o=Math.round(globalDataObj.cashFlowData["Free cash flow Growth"][3]),o<=0&&(o=Math.round(globalDataObj.cashFlowData["Free cash flow Growth"][5]),o<=0&&(o=Math.round(globalDataObj.cashFlowData["Free cash flow Growth"][7]),o<=0&&(o=Math.round(globalDataObj.cashFlowData["Free cash flow Growth"][10]),o<=0&&(o=10))))),document.getElementById("earning-growth").value=o}}),document.getElementById("calculate-reverse-dcf").addEventListener("click",function(t){if(t.target&&"calculate-reverse-dcf"===t.target.id){$(".reverse-dcf-error").remove();const e=parseInt(document.getElementById("fcf").value),a=parseFloat((parseFloat(document.getElementById("discount-rate").value)/100).toFixed(2)),o=parseFloat(parseFloat(document.getElementById("terminal-rate").value/100).toFixed(2)),s=parseInt(document.getElementById("years").value);if(isElementVisible(document.getElementById("terminal-multiple"))){const n=parseInt(document.getElementById("terminal-multiple").value);if(e&&e>0&&a&&a>0&&(o||o>=0)&&n&&n>0){displayReverseDCF(findImpliedEarningsGrowth(e,a,n,b,o,f,s)),t.preventDefault()}else{let t="";e&&e>0?a&&a>0?o||o>=0?n&&n>0||(t="<span class='error-message'>Error:</span> Please enter a valid expected terminal multiple."):t="<span class='error-message'>Error:</span> Please enter a valid Terminal Growth Rate.":t="<span class='error-message'>Error:</span> Please enter a valid Discount Rate.":t="<span class='error-message'>Error:</span> Please enter a valid Free cash flow.",$(`<p class="reverse-dcf-error deletes">${t}</p>`).insertAfter("#reverse-dcf .flex-column"),$("#fcf-growth, #result-wrapper").html("")}}else{const n=parseInt(document.getElementById("earning-growth").value);if(e&&e>0&&a&&a>0&&(o||o>=0)&&n&&n>0){displayReverseDCF(calculateDcf(n/100,e,a,null,b,o,s),!0),t.preventDefault()}else{let t="";e&&e>0?a&&a>0?o||o>=0?u&&u>0||(t="<span class='error-message'>Error:</span> Please enter a valid expected terminal multiple."):t="<span class='error-message'>Error:</span> Please enter a valid Terminal Growth Rate.":t="<span class='error-message'>Error:</span> Please enter a valid Discount Rate.":t="<span class='error-message'>Error:</span> Please enter a valid Free cash flow.",$(`<p class="reverse-dcf-error deletes">${t}</p>`).insertAfter("#reverse-dcf .flex-column"),$("#fcf-growth, #result-wrapper").html("")}}}}),document.querySelector(".company-nav .sub-nav").addEventListener("click",function(t){let e=!1,a=!0;if(t.target&&"Reverse DCF"===t.target.innerHTML){function o(t){e||(e=!0,setTimeout(function(){!a&&contains(".company-nav .sub-nav a","Reverse DCF")[0].classList.remove("active"),e=!1,a=!1,!function(t){let e=t.getBoundingClientRect(),a=window.scrollY;return e.top+a<a+window.innerHeight&&e.bottom+a>a}(document.querySelector("#reverse-dcf h2"))&&window.removeEventListener("scroll",o)},500))}setTimeout(()=>{document.querySelectorAll(".company-nav .sub-nav a").forEach(t=>t.classList.remove("active")),t.target.classList.add("active")},100),window.scrollTo({top:document.getElementById("reverse-dcf").offsetTop-80,behavior:"smooth"}),window.addEventListener("scroll",o)}else window.removeEventListener("scroll",o),contains(".company-nav .sub-nav a","Reverse DCF")[0].classList.remove("active")})}function calculateDcf(t,e,a,o,s,n,l){let r=[Math.round(10*(e*t+e))/10],i=[Math.round(r[0]/Math.pow(1+a,1)*10)/10];for(let e=1;e<l;e++)r[e]=Math.round(10*(r[e-1]*t+r[e-1]))/10,i[e]=Math.round(r[e]/Math.pow(1+a,e+1)*10)/10;const c=r[l-1]*(1+n);let d;d=o?c*o/Math.pow(1+a,l):c/(a-n).toFixed(2)*(1/Math.pow(1+a,parseInt(l)));const f=i.reduce((t,e)=>t+e,0),b=f+d;return{intrinsicValuePerShare:b/s,terminalYearCashFlow:c,presentValueNthYear:f,terminalValue:d,totalPvOfShares:b,breakdown:i.map((e,a)=>({Year:a+1,FCF:r[a],Growth:parseFloat(100*t).toFixed(2)+"%",DiscountedFCF:e}))}}function isElementVisible(t){if(0===t.offsetWidth&&0===t.offsetHeight)return!1;const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&"0"!==e.opacity}function findImpliedEarningsGrowth(t,e,a,o,s,n,l){let r=0;for(;r<=1;){const{intrinsicValuePerShare:i,...c}=calculateDcf(r,t,e,a,o,s,l);if(Math.round(10*i)/10>=n)return{impliedEarningsGrowth:r,intrinsicValuePerShare:i,...c};r+=.001}return{breakdown:{}}}function calculateAverageFCF(t){let e=t.slice(-1);return e.length>0?e.reduce((t,e)=>t+e)/e.length:0}function displayReverseDCF(t,e=!1){const a=document.getElementById("fcf-growth"),o=document.getElementById("result-wrapper"),s=parseFloat(contains("#top-ratios li span","Current Price")[0].nextElementSibling.querySelector("span").textContent.replace(/,/g,"")),n=isNaN(t?.intrinsicValuePerShare)?"N/A":Math.round(100*(1-s/t?.intrinsicValuePerShare)),l=`\n            <table class="data-table">\n                <tbody id="tableValueBody">\n                    <tr class="stripe">\n                        <td>Terminal Year Cash Flow</td>\n                        <td>${isNaN(t?.terminalYearCashFlow)?"N/A":toLocaleStringRounded(t?.terminalYearCashFlow.toFixed(2))}</td>\n                    </tr>\n                    <tr class="">\n                        <td>Present value of 1-10 year</td>\n                        <td>${isNaN(t?.presentValueNthYear)?"N/A":toLocaleStringRounded(t?.presentValueNthYear.toFixed(2))}</td>\n                    </tr>\n                    <tr class="stripe">\n                        <td>Terminal value</td>\n                        <td>${isNaN(t?.terminalValue)?"N/A":toLocaleStringRounded(t?.terminalValue.toFixed(2))}</td>\n                    </tr>\n                    <tr class="">\n                    ${e?`<td class="strong primary-color">Intrinsic Value</td>\n                    <td class="strong ${!isNaN(n)&&n>0?"green-bg-light":"red-bg-light"}">${isNaN(t?.intrinsicValuePerShare)?"N/A":toLocaleStringRounded(t?.intrinsicValuePerShare.toFixed(2))}</td>`:`<td>Total PV of Shares</td>\n                    <td>${isNaN(t?.totalPvOfShares)?"N/A":toLocaleStringRounded(t?.totalPvOfShares.toFixed(2))}</td>`}\n                    </tr>\n                    <tr class="stripe">\n                    ${e?`<td class="strong primary-color">Margin of saftey</td>\n                    <td class="strong ${!isNaN(n)&&n>0?"green-bg":"red-bg"}">${isNaN(n)?"N/A":n}%</td > `:`<td class="strong inserts">The Implied Earnings Growth Rate</td>\n                    <td class="strong">${isNaN(t?.impliedEarningsGrowth)?"N/A":(100*t?.impliedEarningsGrowth).toFixed(2)}%</td>`}\n                    </tr>\n                </tbody>\n            </table>\n            `;if(t.breakdown){a.innerHTML='\n            <table class="data-table">\n                <thead>\n                    <tr>\n                        <th class="text-center">Year</th>\n                        <th>Earnings</th>\n                        <th>Growth Rate</th>\n                        <th>Present Value</th>\n                    </tr>\n                </thead>\n                <tbody id="tableBody">\n                    \x3c!-- Rows will be inserted here --\x3e\n                </tbody>\n            </table>\n            ',o.innerHTML=l;const e=document.getElementById("tableBody");t.breakdown.length>0&&t.breakdown.forEach((t,a)=>{const o=document.createElement("tr");a%2==0&&(o.className="stripe"),["Year","FCF","Growth","DiscountedFCF"].forEach(e=>{const a=document.createElement("td");a.textContent="Growth"!=e?toLocaleStringRounded(t[e]):t[e],"Growth"==e&&a.classList.add("inserts-color"),"Year"==e&&a.classList.add("text-center"),o.appendChild(a)}),e.appendChild(o)})}}function contains(t,e){var a=document.querySelectorAll(t);return Array.from(a).filter(function(t){return t.textContent.includes(e)})}})();